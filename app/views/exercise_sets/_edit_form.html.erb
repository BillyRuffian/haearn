<%= turbo_frame_tag set do %>
  <%= form_with model: set, 
      url: workout_workout_exercise_exercise_set_path(workout, workout_exercise, set),
      method: :patch,
      class: "edit-set-form p-2 bg-dark rounded",
      data: { turbo_frame: dom_id(set) } do |form| %>

    <%# Row 1: Primary fields %>
    <div class="row g-2 align-items-end">
      <div class="col-1 text-center small text-muted pt-3">
        <%= index %>
      </div>

      <% if workout_exercise.exercise.has_weight %>
        <div class="col">
          <label class="form-label small text-muted mb-1">Weight (<%= Current.user.preferred_unit %>)</label>
          <%= form.number_field :weight_value,
              value: set.weight_kg ? Current.user.format_weight(set.weight_kg) : nil,
              class: "form-control form-control-sm text-center",
              step: "any",
              inputmode: "decimal" %>
        </div>
      <% end %>

      <div class="col">
        <% case workout_exercise.exercise.exercise_type %>
        <% when 'reps' %>
          <label class="form-label small text-muted mb-1">Reps</label>
          <%= form.number_field :reps,
              class: "form-control form-control-sm text-center",
              inputmode: "numeric" %>
        <% when 'time' %>
          <label class="form-label small text-muted mb-1">Seconds</label>
          <%= form.number_field :duration_seconds,
              class: "form-control form-control-sm text-center",
              inputmode: "numeric" %>
        <% when 'distance' %>
          <label class="form-label small text-muted mb-1">Meters</label>
          <%= form.number_field :distance_meters,
              class: "form-control form-control-sm text-center",
              inputmode: "decimal",
              step: "any" %>
        <% end %>
      </div>
    </div>

    <%# Row 2: Secondary fields %>
    <div class="row g-2 align-items-center mt-1">
      <div class="col-1"></div>

      <div class="col">
        <label class="form-label small text-muted mb-1">RPE</label>
        <%= form.number_field :rpe,
            class: "form-control form-control-sm text-center",
            placeholder: "—",
            min: 1,
            max: 10,
            step: 0.5,
            inputmode: "decimal" %>
      </div>

      <div class="col">
        <label class="form-label small text-muted mb-1">RIR</label>
        <%= form.number_field :rir,
            class: "form-control form-control-sm text-center",
            placeholder: "—",
            min: 0,
            max: 10,
            inputmode: "numeric" %>
      </div>

      <div class="col-auto">
        <div class="form-check mt-3">
          <%= form.check_box :is_warmup, class: "form-check-input" %>
          <label class="form-check-label small">W/U</label>
        </div>
      </div>

      <div class="col-auto">
        <div class="form-check mt-3">
          <%= form.check_box :is_amrap, class: "form-check-input" %>
          <label class="form-check-label small">AMRAP</label>
        </div>
      </div>
    </div>

    <%# Row 3: Set type and Tempo %>
    <div class="row g-2 align-items-center mt-1">
      <div class="col-1"></div>

      <div class="col">
        <label class="form-label small text-muted mb-1">Type</label>
        <%= form.select :set_type,
            ExerciseSet::SET_TYPES.map { |t| [ExerciseSet.new(set_type: t).set_type_label, t] },
            {},
            class: "form-select form-select-sm" %>
      </div>

      <div class="col-auto">
        <label class="form-label small text-muted mb-1">Tempo</label>
        <div class="d-flex gap-1">
          <%= form.number_field :tempo_eccentric, class: "form-control form-control-sm text-center", style: "width: 40px;", placeholder: "E", min: 0, max: 30, inputmode: "numeric" %>
          <%= form.number_field :tempo_pause_bottom, class: "form-control form-control-sm text-center", style: "width: 40px;", placeholder: "P", min: 0, max: 30, inputmode: "numeric" %>
          <%= form.number_field :tempo_concentric, class: "form-control form-control-sm text-center", style: "width: 40px;", placeholder: "C", min: 0, max: 30, inputmode: "numeric" %>
          <%= form.number_field :tempo_pause_top, class: "form-control form-control-sm text-center", style: "width: 40px;", placeholder: "T", min: 0, max: 30, inputmode: "numeric" %>
        </div>
      </div>
    </div>

    <%# Row 4: Equipment & Outcomes %>
    <div class="row g-2 align-items-center mt-1">
      <div class="col-1"></div>
      <div class="col">
        <div class="d-flex flex-wrap gap-2">
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :belt, class: "form-check-input" %>
            <label class="form-check-label small">Belt</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :knee_sleeves, class: "form-check-input" %>
            <label class="form-check-label small">KS</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :wrist_wraps, class: "form-check-input" %>
            <label class="form-check-label small">WW</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :straps, class: "form-check-input" %>
            <label class="form-check-label small">Straps</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :is_failed, class: "form-check-input" %>
            <label class="form-check-label small text-danger">Fail</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :spotter_assisted, class: "form-check-input" %>
            <label class="form-check-label small">Spot</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :pain_flag, class: "form-check-input" %>
            <label class="form-check-label small text-danger">Pain</label>
          </div>
          <div class="form-check form-check-inline mb-0">
            <%= form.check_box :is_bfr, class: "form-check-input" %>
            <label class="form-check-label small">BFR</label>
          </div>
        </div>
      </div>
    </div>

    <%# Row 5: Partials, Pain note, Bands, Chains %>
    <div class="row g-2 align-items-center mt-1">
      <div class="col-1"></div>
      <div class="col-2">
        <label class="form-label small text-muted mb-0">Partials</label>
        <%= form.number_field :partial_reps, class: "form-control form-control-sm text-center", placeholder: "—", min: 1, inputmode: "numeric" %>
      </div>
      <div class="col">
        <label class="form-label small text-muted mb-0">Pain Note</label>
        <%= form.text_field :pain_note, class: "form-control form-control-sm", placeholder: "What hurts?" %>
      </div>
      <div class="col-2">
        <label class="form-label small text-muted mb-0">Bands</label>
        <%= form.number_field :band_tension_kg, class: "form-control form-control-sm text-center", placeholder: "—", step: "any", min: 0, inputmode: "decimal" %>
      </div>
      <div class="col-2">
        <label class="form-label small text-muted mb-0">Chains</label>
        <%= form.number_field :chain_weight_kg, class: "form-control form-control-sm text-center", placeholder: "—", step: "any", min: 0, inputmode: "decimal" %>
      </div>
    </div>

    <%# Actions %>
    <div class="d-flex gap-2 justify-content-end mt-2">
      <%= form.submit "Save", class: "btn btn-primary btn-sm" %>
      <%= link_to "Cancel", workout_path(workout), class: "btn btn-outline-secondary btn-sm", data: { turbo_frame: "_top" } %>
    </div>
  <% end %>
<% end %>
