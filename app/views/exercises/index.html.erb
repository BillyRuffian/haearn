<% content_for(:title) { "Exercise Library | Haearn" } %>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-heading mb-0">
      <i class="bi bi-list-check me-2"></i>Exercise Library
    </h1>
  </div>

  <p class="text-muted mb-4">
    Browse all exercises or create your own custom ones.
  </p>

  <!-- Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <%= form_with url: exercises_path, method: :get, data: { controller: "search", turbo_frame: "exercises_list", turbo_action: "advance" }, class: "row g-3 align-items-end" do |form| %>
        <div class="col-md-4">
          <%= form.label :q, "Search", class: "form-label" %>
          <%= form.text_field :q, value: params[:q], class: "form-control", placeholder: "Search exercises...", data: { action: "input->search#search" } %>
        </div>

        <div class="col-md-2">
          <%= form.label :type, "Type", class: "form-label" %>
          <%= form.select :type, 
              [["All Types", ""]] + Exercise::EXERCISE_TYPES.map { |t| [t.titleize, t] },
              { selected: params[:type] },
              class: "form-select",
              data: { controller: "custom-select", action: "change->search#search" } %>
        </div>

        <div class="col-md-2">
          <%= form.label :weighted, "Weighted", class: "form-label" %>
          <%= form.select :weighted, 
              [["All", ""], ["Weighted", "true"], ["Bodyweight", "false"]],
              { selected: params[:weighted] },
              class: "form-select",
              data: { controller: "custom-select", action: "change->search#search" } %>
        </div>

        <div class="col-md-2">
          <%= form.label :source, "Source", class: "form-label" %>
          <%= form.select :source, 
              [["All", ""], ["Global", "global"], ["My Exercises", "mine"]],
              { selected: params[:source] },
              class: "form-select",
              data: { controller: "custom-select", action: "change->search#search" } %>
        </div>

        <div class="col-md-2">
          <%= form.submit "Filter", class: "btn btn-primary w-100" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Create New Exercise -->
  <div class="card mb-4">
    <div class="card-header">
      <i class="bi bi-plus-lg me-2"></i>Create Custom Exercise
    </div>
    <div class="card-body">
      <%= turbo_frame_tag "new_exercise_form" do %>
        <%= render "form", exercise: @exercise %>
      <% end %>
    </div>
  </div>

  <!-- Exercises List -->
  <%= turbo_frame_tag "exercises_list" do %>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="text-muted"><%= @exercises.count %> exercises</span>
    </div>

    <div id="exercises">
      <% if @exercises.any? %>
        <% @exercises.each do |exercise| %>
          <%= render "exercise", exercise: exercise %>
        <% end %>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-search display-4 text-muted"></i>
          <p class="text-muted mt-3">No exercises found. Try a different search.</p>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
