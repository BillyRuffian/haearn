<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Dark theme matching Haearn's website */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: #0d0d0d;
      color: #e0e0e0;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #1a1a1a;
    }
    
    .header {
      background: linear-gradient(135deg, #c86432 0%, #8b4513 100%);
      padding: 40px 20px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      color: #ffffff;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .header p {
      margin: 8px 0 0 0;
      color: rgba(255, 255, 255, 0.9);
      font-size: 16px;
    }
    
    .content {
      padding: 30px 20px;
    }
    
    .greeting {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 20px;
    }
    
    .stats-grid {
      display: table;
      width: 100%;
      margin: 20px 0;
    }
    
    .stat-card {
      background-color: #242424;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid #c86432;
    }
    
    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #8a8a8a;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #ff6b35;
      line-height: 1;
      margin-bottom: 4px;
    }
    
    .stat-unit {
      font-size: 16px;
      color: #8a8a8a;
    }
    
    .comparison {
      font-size: 14px;
      color: #71797E;
      margin-top: 8px;
    }
    
    .comparison.positive {
      color: #4CAF50;
    }
    
    .comparison.negative {
      color: #f44336;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #ffffff;
      margin: 30px 0 15px 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 2px solid #c86432;
      padding-bottom: 8px;
    }
    
    .highlight {
      background-color: #242424;
      border-left: 4px solid #4CAF50;
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    
    .highlight.warning {
      border-left-color: #ff9800;
    }
    
    .highlight-text {
      font-size: 15px;
      color: #e0e0e0;
      margin: 0;
    }
    
    .exercise-item {
      background-color: #242424;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 4px;
      display: table;
      width: 100%;
    }
    
    .exercise-name {
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }
    
    .exercise-stats {
      font-size: 14px;
      color: #8a8a8a;
    }
    
    .pr-badge {
      display: inline-block;
      background-color: #c86432;
      color: #ffffff;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-right: 8px;
    }
    
    .footer {
      background-color: #121212;
      padding: 30px 20px;
      text-align: center;
      border-top: 1px solid #2a2a2a;
    }
    
    .footer-text {
      font-size: 13px;
      color: #6a6a6a;
      margin: 5px 0;
    }
    
    .footer-link {
      color: #c86432;
      text-decoration: none;
    }
    
    .footer-link:hover {
      text-decoration: underline;
    }
    
    .cta-button {
      display: inline-block;
      background-color: #c86432;
      color: #ffffff !important;
      padding: 15px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      margin: 20px 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 14px;
    }
    
    .empty-state {
      background-color: #242424;
      padding: 40px 20px;
      text-align: center;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }
    
    .empty-state-text {
      font-size: 16px;
      color: #8a8a8a;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üí™ Haearn</h1>
      <p>Weekly Workout Summary</p>
    </div>
    
    <!-- Content -->
    <div class="content">
      <p class="greeting">Hey <%= @user.name %>,</p>
      
      <p style="color: #b0b0b0; font-size: 15px; line-height: 1.6;">
        Here's your training summary for <strong style="color: #ffffff;"><%= @summary[:week_label] %></strong>.
        <% if @summary[:vs_average] %>
          Let's see how you stacked up against your average!
        <% end %>
      </p>
      
      <!-- Main Stats -->
      <% if @summary[:this_week][:workout_count] > 0 %>
        <div class="stats-grid">
          <!-- Workouts -->
          <div class="stat-card">
            <div class="stat-label">Workouts</div>
            <div class="stat-value"><%= @summary[:this_week][:workout_count] %></div>
            <% if @summary[:vs_average] %>
              <% diff = @summary[:vs_average][:workout_count_diff] %>
              <% pct = @summary[:vs_average][:workout_count_pct] %>
              <div class="comparison <%= diff >= 0 ? 'positive' : 'negative' %>">
                <%= diff >= 0 ? '‚Üë' : '‚Üì' %> <%= diff.abs.round(1) %> 
                (<%= pct >= 0 ? '+' : '' %><%= pct %>%) vs avg
              </div>
            <% end %>
          </div>
          
          <!-- Volume -->
          <div class="stat-card">
            <div class="stat-label">Total Volume</div>
            <div class="stat-value">
              <%= number_with_delimiter(WeightConverter.from_kg(@summary[:this_week][:total_volume_kg], @user.preferred_unit).round) %>
              <span class="stat-unit"><%= @user.preferred_unit %></span>
            </div>
            <% if @summary[:vs_average] %>
              <% diff = @summary[:vs_average][:volume_diff_kg] %>
              <% pct = @summary[:vs_average][:volume_pct] %>
              <div class="comparison <%= diff >= 0 ? 'positive' : 'negative' %>">
                <%= diff >= 0 ? '‚Üë' : '‚Üì' %> <%= number_with_delimiter(WeightConverter.from_kg(diff.abs, @user.preferred_unit).round) %> <%= @user.preferred_unit %>
                (<%= pct >= 0 ? '+' : '' %><%= pct %>%) vs avg
              </div>
            <% end %>
          </div>
          
          <!-- Sets & Reps -->
          <div class="stat-card">
            <div class="stat-label">Total Sets</div>
            <div class="stat-value"><%= @summary[:this_week][:total_sets] %></div>
            <div class="stat-unit"><%= number_with_delimiter(@summary[:this_week][:total_reps]) %> total reps</div>
            <% if @summary[:vs_average] %>
              <% diff = @summary[:vs_average][:sets_diff] %>
              <% pct = @summary[:vs_average][:sets_pct] %>
              <div class="comparison <%= diff >= 0 ? 'positive' : 'negative' %>">
                <%= diff >= 0 ? '‚Üë' : '‚Üì' %> <%= diff.abs %> sets
                (<%= pct >= 0 ? '+' : '' %><%= pct %>%) vs avg
              </div>
            <% end %>
          </div>
          
          <!-- Time -->
          <div class="stat-card">
            <div class="stat-label">Training Time</div>
            <div class="stat-value">
              <%= (@summary[:this_week][:total_duration_minutes] / 60.0).round(1) %>
              <span class="stat-unit">hours</span>
            </div>
            <div class="stat-unit"><%= @summary[:this_week][:unique_exercises] %> different exercises</div>
          </div>
        </div>
        
        <!-- Highlights -->
        <% if @summary[:highlights].any? %>
          <h2 class="section-title">üåü Highlights</h2>
          <% @summary[:highlights].each do |highlight| %>
            <div class="highlight <%= highlight[:type] == :missed_week ? 'warning' : '' %>">
              <p class="highlight-text"><%= highlight[:message] %></p>
            </div>
          <% end %>
        <% end %>
        
        <!-- New PRs -->
        <% if @summary[:new_prs].any? %>
          <h2 class="section-title">üèÜ New Personal Records</h2>
          <% @summary[:new_prs].each do |pr| %>
            <div class="exercise-item">
              <div class="exercise-name">
                <span class="pr-badge">PR</span>
                <%= pr[:exercise_name] %>
              </div>
              <div class="exercise-stats">
                <%= number_with_delimiter(WeightConverter.from_kg(pr[:value_kg], @user.preferred_unit).round) %> <%= @user.preferred_unit %> 
                √ó <%= pr[:reps] %> reps
              </div>
            </div>
          <% end %>
        <% end %>
        
        <!-- Top Exercises -->
        <% if @summary[:top_exercises].any? %>
          <h2 class="section-title">üìä Top Exercises by Volume</h2>
          <% @summary[:top_exercises].each do |exercise| %>
            <div class="exercise-item">
              <div class="exercise-name"><%= exercise[:exercise_name] %></div>
              <div class="exercise-stats">
                <%= number_with_delimiter(WeightConverter.from_kg(exercise[:volume_kg], @user.preferred_unit).round) %> <%= @user.preferred_unit %> 
                total (<%= exercise[:set_count] %> sets)
              </div>
            </div>
          <% end %>
        <% end %>
        
        <!-- Consistency -->
        <% if @summary[:consistency] %>
          <h2 class="section-title">üìÖ Consistency</h2>
          <div class="stat-card">
            <% streak = @summary[:consistency][:current_streak] %>
            <p style="font-size: 16px; color: #e0e0e0; margin: 0 0 10px 0;">
              <% if streak > 0 %>
                <strong style="color: #4CAF50; font-size: 24px;"><%= streak %></strong> week streak!
                <% if streak >= 4 %>
                  Keep it up! üî•
                <% end %>
              <% else %>
                Time to start a new streak! üí™
              <% end %>
            </p>
            <p style="font-size: 14px; color: #8a8a8a; margin: 0;">
              Trained <%= @summary[:consistency][:weeks_trained_last_4] %> of the last 4 weeks
            </p>
          </div>
        <% end %>
        
        <!-- CTA -->
        <div style="text-align: center; margin-top: 40px;">
          <a href="<%= root_url %>" class="cta-button">View Full Dashboard</a>
        </div>
        
      <% else %>
        <!-- Empty State -->
        <div class="empty-state">
          <div class="empty-state-icon">üò¥</div>
          <p class="empty-state-text">
            No workouts logged this week.<br>
            Time to get back to the iron!
          </p>
          <a href="<%= new_workout_url %>" class="cta-button" style="margin-top: 20px;">Start a Workout</a>
        </div>
      <% end %>
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <p class="footer-text">
        <strong>Haearn</strong> - Hardcore Weightlifting Tracking
      </p>
      <p class="footer-text">
        <a href="<%= settings_url %>" class="footer-link">Manage Email Preferences</a>
      </p>
      <p class="footer-text" style="margin-top: 15px; font-size: 12px;">
        You're receiving this because you opted in to weekly summaries.
      </p>
    </div>
  </div>
</body>
</html>
