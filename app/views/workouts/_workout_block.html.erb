<div class="card mb-3 workout-block" id="<%= dom_id(block) %>" data-block-id="<%= block.id %>">
  <% if workout.in_progress? %>
    <div class="drag-handle d-flex justify-content-between align-items-center px-3 py-2 border-bottom bg-dark bg-opacity-25">
      <div class="d-flex align-items-center">
        <i class="bi bi-grip-vertical text-muted me-2"></i>
        <% if block.superset? %>
          <span class="badge bg-warning text-dark">
            <i class="bi bi-arrow-repeat me-1"></i>Superset (<%= block.workout_exercises.count %> exercises)
          </span>
        <% else %>
          <span class="text-muted small">Block <%= block.position %></span>
        <% end %>
      </div>
      <div class="d-flex align-items-center gap-2">
        <%# Per-block rest timer adjuster %>
        <div class="d-flex align-items-center gap-1"
             data-controller="block-rest"
             data-block-rest-url-value="<%= update_block_rest_workout_path(workout) %>"
             data-block-rest-seconds-value="<%= block.rest_seconds %>"
             data-block-rest-block-id-value="<%= block.id %>">
          <button type="button" class="btn btn-sm btn-outline-secondary py-0 px-1"
                  data-action="block-rest#decrease" title="Decrease rest">
            <i class="bi bi-dash"></i>
          </button>
          <span class="small text-muted" data-block-rest-target="display" style="min-width: 36px; text-align: center;">
            <%= "#{block.rest_seconds / 60}:#{(block.rest_seconds % 60).to_s.rjust(2, '0')}" %>
          </span>
          <button type="button" class="btn btn-sm btn-outline-secondary py-0 px-1"
                  data-action="block-rest#increase" title="Increase rest">
            <i class="bi bi-plus"></i>
          </button>
        </div>
        <%= link_to add_exercise_workout_path(workout, to_block: block.id),
            class: "btn btn-sm btn-outline-primary",
            data: { turbo_frame: "modal" },
            title: "Add exercise to this block (superset)",
            onclick: "event.stopPropagation();" do %>
          <i class="bi bi-plus"></i><span class="ms-1">Superset</span>
        <% end %>
      </div>
    </div>
  <% end %>
  <% block.workout_exercises.order(:position).each_with_index do |workout_exercise, index| %>
    <% is_superset = block.workout_exercises.count > 1 %>
    <%= render "workout_exercise", 
        workout_exercise: workout_exercise, 
        workout: workout,
        superset_label: is_superset ? "#{(block.position + 64).chr}#{index + 1}" : nil %>
  <% end %>
</div>
