<% show_date = local_assigns.fetch(:show_date, false) %>
<% show_copy = local_assigns.fetch(:show_copy, false) %>
<div class="list-group-item list-group-item-action bg-transparent border-secondary px-0 py-3 workout-history-item">
  <div class="d-flex justify-content-between align-items-center">
    <%= link_to workout_path(workout), class: "flex-grow-1 text-decoration-none", data: { turbo_frame: "_top" } do %>
      <div class="d-flex justify-content-between align-items-center mb-2 w-100">
        <div>
          <h6 class="mb-1">
            <% if show_date %>
              <%= workout.started_at.strftime("%A, %B %-d, %Y") %>
            <% else %>
              <%= workout.gym&.name || "Workout" %>
            <% end %>
            <% if workout.in_progress? %>
              <span class="badge bg-warning ms-2">In Progress</span>
            <% end %>
          </h6>
          <p class="text-muted mb-0 small">
            <% if show_date && workout.gym %>
              <i class="bi bi-building me-1"></i><%= workout.gym.name %> &middot;
            <% elsif !show_date %>
              <%= workout.finished_at&.strftime("%b %d, %Y") %> &middot;
            <% end %>
            <% if workout.completed? || !show_date %>
              <%= workout.duration_minutes || 0 %> min &middot;
            <% end %>
            <%= pluralize(workout.workout_exercises.count, "exercise") %> &middot;
            <%= pluralize(workout.exercise_sets.count, "set") %>
          </p>
        </div>
        <div class="text-end me-3">
          <span class="weight-display h5 mb-0">
            <%= number_with_delimiter(Current.user.format_weight(workout.total_volume_kg)) %>
          </span>
          <span class="text-muted small"><%= Current.user.preferred_unit %></span>
        </div>
      </div>
      <%= render "workouts/muscle_group_badges", workout: workout %>
    <% end %>
    <% if show_copy && workout.completed? %>
      <%= button_to copy_workout_path(workout), method: :post, class: "btn btn-outline-primary btn-sm copy-workout-btn", title: "Repeat this workout", data: { turbo_confirm: "Start a new workout based on this one?" } do %>
        <i class="bi bi-arrow-repeat"></i>
      <% end %>
    <% end %>
  </div>
</div>
