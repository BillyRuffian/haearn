<div class="container py-4">
  <div class="mb-4">
    <h1 class="display-6">
      <i class="bi bi-pencil me-2"></i>Edit Exercise
    </h1>
    <p class="text-muted"><%= @template.name %></p>
  </div>

  <%= form_with model: @template_exercise, 
                url: workout_template_template_exercise_path(@template, @template_exercise),
                method: :patch,
                local: true do |f| %>
    <% if @template_exercise.errors.any? %>
      <div class="alert alert-danger">
        <h5>Please fix the following errors:</h5>
        <ul class="mb-0">
          <% @template_exercise.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="card mb-3">
      <div class="card-body">
        <!-- Exercise (read-only, show name) -->
        <div class="mb-3">
          <label class="form-label">Exercise</label>
          <div class="form-control-plaintext">
            <strong><%= @template_exercise.exercise.name %></strong>
          </div>
          <div class="form-text">To change the exercise, delete this one and add a new one</div>
        </div>

        <!-- Machine Selection -->
        <div class="mb-3">
          <%= f.label :machine_id, "Machine (optional)", class: "form-label" %>
          <%= f.select :machine_id,
              grouped_options_for_select(
                @machines.group_by { |m| m.gym.name }.map do |gym_name, machines|
                  [
                    gym_name,
                    machines.map { |m| [m.name, m.id] }
                  ]
                end,
                @template_exercise.machine_id
              ),
              { include_blank: "None / Free weight" },
              { class: "form-select" } %>
        </div>

        <hr>

        <!-- Target Sets/Reps/Weight -->
        <h6 class="mb-3">Target Guidelines (optional)</h6>
        
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <%= f.label :target_sets, "Sets", class: "form-label" %>
            <%= f.number_field :target_sets,
                class: "form-control",
                min: 1 %>
          </div>
          
          <div class="col-md-4">
            <%= f.label :target_reps, "Reps", class: "form-label" %>
            <%= f.number_field :target_reps,
                class: "form-control",
                min: 1 %>
          </div>
          
          <div class="col-md-4">
            <%= f.label :target_weight_kg, "Weight (#{Current.user.preferred_unit})", class: "form-label" %>
            <%= f.number_field :target_weight_kg,
                class: "form-control",
                step: 0.5,
                min: 0 %>
          </div>
        </div>

        <!-- Persistent Notes -->
        <div class="mb-3">
          <%= f.label :persistent_notes, "Persistent Notes (optional)", class: "form-label" %>
          <%= f.text_area :persistent_notes,
              class: "form-control",
              rows: 2,
              placeholder: "Equipment setup, form cues, etc." %>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2">
      <%= f.submit "Update Exercise", class: "btn btn-primary" %>
      <%= link_to "Cancel", @template, class: "btn btn-outline-secondary" %>
      <%= button_to "Delete", workout_template_template_exercise_path(@template, @template_exercise),
          method: :delete,
          class: "btn btn-outline-danger ms-auto",
          data: { turbo_confirm: "Remove this exercise from the template?" } %>
    </div>
  <% end %>
</div>
